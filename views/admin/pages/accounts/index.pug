extends ../../layout/default.pug
include ../../mixin/alert.pug
include ../../mixin/moment.pug


block main 
  if(role.permissions.includes("accounts_view"))
    +alert-error(5000)
    +alert-success(5000)
    h2(class="mb-4") Nhóm quyền

    .card.mb-3 
      .card-header Danh sách
      .card-body
        if(role.permissions.includes("accounts_create"))
          .row 
            .col-8
              
            .col-4.text-right
              a(
                href=`${prefixAdmin}/accounts/create`
                class="btn btn-outline-success active"
              ) +Thêm mới
        table(class="table table-hover table-sm")
          thead 
            tr 
              th STT
              th Avatar
              th Họ tên
              th Phân quyền
              th Email
              th Trạng thái
              th Người tạo
              th Người chỉnh sửa 
              th Hành động
          tbody
            each item, index in accounts
              tr
                td #{index+1}
                td 
                  img(
                    src=item.avatar 
                    alt=item.fullName
                    width="100px" 
                    height="auto"
                  )
                td #{item.fullName}
                td #{item.role.title}
                td #{item.email}
                td
                  if(role.permissions.includes("accounts_edit"))
                    if(item.status == "active")
                      a(
                        href="javascript:;" 
                        class="badge badge-success"
                        button-change-status 
                        data-status=item.status 
                        data-id=item.id
                      ) Hoạt động
                    else 
                      a(
                        href="javascript:;" 
                        class="badge badge-danger"
                        button-change-status 
                        data-status=item.status 
                        data-id=item.id
                      ) Dừng hoạt động
                  else 
                      if(item.status == "active")
                          a(
                              href="" 
                              class="badge badge-success"
                          ) Hoạt động
                      else 
                          a(
                              href="" 
                              class="badge badge-danger"
                          ) Dừng hoạt động

                td 
                  p #{item.account_Fullname}
                  p   
                    +formatDate(item.createdBy.createdAt)

                td 
                  - const updatedBy =item.updatedBy.slice(-1)[0]
                  if(updatedBy)
                    p #{updatedBy.account_Fullname}
                    p   
                      +formatDate(updatedBy.createdAt)
              
                td 
                  a(
                    href=`${prefixAdmin}/accounts/detail/${item.id}`
                    class="btn btn-info"
                  ) Chi tiết

                  if(role.permissions.includes("accounts_edit"))
                    a(
                      href=`${prefixAdmin}/accounts/edit/${item.id}`
                      class="btn btn-warning"
                    ) Sửa
                  
                  if(role.permissions.includes("accounts_delete"))
                    button(
                      class="btn btn-danger"
                      button-delete
                      data-id=item.id
                    ) Xóa

    form(
      action=""
      method="POST"
      id="form-change-status"
      data-path=`${prefixAdmin}/accounts/change-status`
    ) 

    form(
      action=""
      method="POST"
      id="form-delete-item"
      data-path=`${prefixAdmin}/accounts/delete`
    )
    script(src="/admin/js/products.js")